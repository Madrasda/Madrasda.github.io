import Head from 'next/head'
import VendorLayout from '@/components/layout-vendor'
import Accordion from '@/components/accordian'
import Image from 'next/image'
import {forwardRef, useEffect, useState} from "react";
import {useRouter} from "next/router";
import {getRole, isTokenValid} from "@/utils/JWTVerifier"
import {Button, Snackbar, TextField} from "@mui/material";
import MuiAlert from "@mui/material/Alert";
import CssBaseline from "@mui/material/CssBaseline";

const Alert = forwardRef(function Alert(props, ref) { //snackbar alert
	return <MuiAlert elevation={6} ref={ref} variant="filled" {...props} />;
});
export default function Feedback() {
	const [tokenExists, setTokenExists] = useState(false);
	const [message, setMessage] = useState("");
	const [severity, setSeverity] = useState("success");
	const [open, setOpen] = useState(false);
	const [error, setError] = useState(false);
	const router = useRouter();
	let isReady = router.isReady;
	const [inputValue, setInputValue] = useState("");
	const [loading, setLoading] = useState(false);
	useEffect(() => {
		setLoading(true);
		setTimeout(() => {
			setLoading(false);
		}, 1000);
	}, []);
	const handleSubmit = async (event) => {
		event.preventDefault();
		if (inputValue === "") {
			setError(true)
			setOpen(true);
			setMessage("Please enter all fields");
			setSeverity("error");
			return;
		}
		try {
			const response = await fetch(
				"https://spring-madrasda-2f6mra4vwa-em.a.run.app/api/feedback/postFeedback",
				{
					method: "POST",
					headers: {
						"Content-Type": "application/json",
						Authorization: "Bearer " + localStorage.getItem("token"),
					},
					body: JSON.stringify({query: inputValue, resolution: false}),
				}
			).then((res) => {
				setOpen(true);
				setMessage("Query Successfully Sent");
				setSeverity("success");
				setInputValue("");
			});
		} catch (error) {
			setOpen(true);
			setMessage("An error has occurred, please try again");
			setSeverity("error");
		}
		setInputValue("");
	};

	const handleClose = (event, reason) => {
		console.log(reason);
		if (reason === "clickaway") {
			return;
		}

		setOpen(false);
	};

	useEffect(() => {
		const jwtToken = localStorage.getItem("token");
		if (jwtToken === undefined || !isTokenValid(jwtToken) || getRole(jwtToken) !== 'ROLE_VENDOR')
			router.push("/vendor");
		else setTokenExists(true);
	}, []);
	// if (loading && isReady)
	// 	return (
	// 		<div className='z-50 h-screen w-screen overflow-hidden'>
	// 			<Image
	// 				src='/loader.gif'
	// 				width={1920}
	// 				height={1080}
	// 				className='object-cover object-center w-full h-full'
	// 			/>
	// 		</div>
	// 	);
	return (
		<>
			<Snackbar
				className={"mt-7"}
				open={open}
				autoHideDuration={1400}
				onClose={handleClose}
				anchorOrigin={{vertical: "top", horizontal: "right"}}>
				<Alert onClose={handleClose} severity={severity}>
					{message}
				</Alert>
			</Snackbar>
			<Head>
				<title>Create Next App</title>
				<meta name='description' content='Generated by create next app'/>
				<meta name='viewport' content='width=device-width, initial-scale=1'/>
				<link rel='icon' href='/logo.png'/>
				<title>Madrasda | Feedback</title>
			</Head>

			{tokenExists && <VendorLayout>
				<main className='md:ml-32 overflow-hidden font-raj'>
					<div className='mt-20 px-5 md:my-10 mx-auto'>
						<div className='md:ml-24 md:mt-10'>
							<h1 className='body-font text-primary text-3xl'>
								QUERIES
							</h1>
						</div>

						<hr className='h-px md:ml-20 md:mr-12 my-6 border-shadowGrey border-1'></hr>
						<div className='md:ml-24 lg:ml-32'>
							<h1 className='title-font font-medium text-2xl pb-8 text-[#535253]'>
								1.Post your Queries:
							</h1>
							<form className={'mr-12'}>
								<TextField
									id='comment'
									rows={4}
									label={'Your comment'}
									className='w-full px-0 text-sm text-black mb-3'
									placeholder='Write your queries...'
									required
									multiline
									value={inputValue}
									error={error}
									onChange={(e) => setInputValue(e.target.value)}
								/>
								<div className='pt-4'>
								<Button
									variant={'contained'}
									onClick={handleSubmit}>
									Post Query
								</Button>
								</div>
							</form>
						</div>

						<hr className='h-px md:ml-20 md:mr-12 my-6 border-shadowGrey border-1'></hr>

						<div className='md:ml-24 lg:ml-32'>
							<h1 className='title-font font-medium text-2xl pb-8 text-[#535253]'>2.FAQ:</h1>
							<Accordion
								title="What's included in the quoted daily rate?"
								content='this is content 1'
								border='border-rounded'
							/>
							<Accordion
								title="What's included in the quoted daily rate?"
								content='this is content 1'
							/>
							<Accordion
								title="What's included in the quoted daily rate?"
								content='this is content 1'
							/>
							<Accordion
								title="What's included in the quoted daily rate?"
								content='this is content 1'
							/>
							<Accordion
								title="What's included in the quoted daily rate?"
								content='this is content 1'
							/>
						</div>

						<hr className='h-px md:ml-20 md:mr-12 my-6 border-shadowGrey border-1'></hr>

						<div className='md:ml-24 lg:ml-32 text-[#2c2c2d]'>
							<h1 className='title-font font-medium text-2xl pb-8 text-[#535253]'>
								Admin Contact Details
							</h1>
							<h2>Whatsapp: 9884944786</h2>
							<h2>Email: </h2>
							<h2>Phone Number: </h2>
						</div>

						<hr className='h-px md:ml-20 md:mr-12 my-6 border-shadowGrey border-1'></hr>
					</div>
				</main>
			</VendorLayout>}
		</>
	);
}
