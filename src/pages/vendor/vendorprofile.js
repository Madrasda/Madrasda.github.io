import VendorLayout from '@/components/layout-vendor'
import React from 'react'
import Head from 'next/head'
import Image from "next/image";
import Link from 'next/link';
import axios from "axios";
import { useEffect,useState } from "react";
import { useRouter } from "next/router";
import {getRole, isTokenValid} from "@/utils/JWTVerifier";
import {Backdrop, CircularProgress, Snackbar} from "@mui/material";
//import MuiAlert from "@mui/material/Alert";
//import {UserContext} from "../../context/context";

export default function VendorProfile(props) {

  const [tokenExists, setTokenExists] = useState(false)
  const router = useRouter();
  let isReady = router.isReady;
  const { id } = router.query;
  const [details, setDetails] = useState(null);
  const [loading, setLoading] = useState(false);
  const [spinner, setSpinnerState] = useState(false);
  useEffect(() => {
    setLoading(true);
    setTimeout(() => {
    setLoading(false);
      }, 1000);
  }, []);
  const getVendorDetails = async () => {
    const response = await axios.get(
      "https://spring-madrasda-2f6mra4vwa-em.a.run.app/api/vendor/" , { 
        headers : {
          Authorization : "Bearer " + localStorage.getItem('token')
        }
      }  
    );
    setDetails(response.data);
}

useEffect(() => {
  if(isReady)
      getVendorDetails();
}, [isReady]);

  useEffect(() => {
    const jwtToken = localStorage.getItem("token")
    if (jwtToken === undefined || !isTokenValid(jwtToken) || getRole(jwtToken) !== 'ROLE_VENDOR')
      router.push("/vendor");
    else
      setTokenExists(true);
  }, []);

  if(loading && isReady)
  return (<div className='z-50 h-screen w-screen overflow-hidden'>
  <Image src="/loader.gif" width={1920} height={1080} className="object-cover object-center w-full h-full"/>
  </div>);
  return (
    <>
      <Head>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/logo.png' />
        <title>Madrasda | Vendor Profile</title>
      </Head>
      {!tokenExists && <h1> LOADING... </h1>}
      {tokenExists && details && (
        <VendorLayout>
          <section className='body-font font-algeria overflow-hidden md:ml-56 lg:ml-36'>
            <div className='mt-20 px-5 md:my-10 mx-auto lg:ml-20 md:mt-10'>
              <h1 className='text-3xl text-primary'>PROFILE</h1>
              <div className='grid gap-6 mt-10 ml-2 mb-2 md:grid-row lg:mr-96'>
                <div className='w-[100px] h-[100px] md:h-[200px] md:w-[200px] overflow-hidden rounded-full'>
                  <Image
                    alt='vendor'
                    className='object-cover object-center w-full h-full md:w-auto'
                    src={details.vendor.imgUrl || "/CREATOR.png"}
                    width={100}
                    height={100}
                  />
                </div>
                <div>
                  <label
                    for='first_name'
                    className='block mb-2 text-lg font-medium text-black'>
                    Company Name :
                  </label>
                  <h1
                    type='text'
                    className='bg-black-50 border-b border-gray text-black text-sm block w-full p-2.5'>
                    {details.vendor.companyName}
                  </h1>
                </div>
                <div>
                  <label
                    for='last_name'
                    className='block mb-2 text-lg font-medium text-black'>
                    Copmany URL :
                  </label>
                  <h1
                    type='text'
                    className='bg-black-50 border-b  border-gray  text-black text-sm block w-full p-2.5'>
                    {details.vendor.companyUrl}
                  </h1>
                </div>
                <div>
                  <label
                    for='company'
                    className='block mb-2 text-lg font-medium text-black'>
                    Email :
                  </label>
                  <h1
                    type='text'
                    className='bg-black-50 border-b  border-gray  text-black text-sm block w-full p-2.5'>
                    {details.vendor.email}
                  </h1>
                </div>
                <div>
                  <label
                    for='phone'
                    className='block mb-2 text-lg font-medium text-black '>
                    Phone Number :
                  </label>
                  <h1
                    type='text'
                    className='bg-black-50 border-b  border-gray  text-black text-sm block w-full p-2.5'>
                    {"+91 " + !details.vendor.phone
                      ? "+91 xxxxxxxxxx"
                      : details.vendor.phone}
                  </h1>
                </div>
              </div>
            </div>
          </section>
        </VendorLayout>
      )}
    </>
  );
}
